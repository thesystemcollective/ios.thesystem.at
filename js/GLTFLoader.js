import{M as t}from"./MathUtils.js";import{bm as e,T as s,R as i,w as n,t as r,am as o,ah as a,D as c,s as h,bz as l,N as u,aj as p,al as d,ak as f,b as m,ai as g,bB as y,F as v,bC as b,bD as M}from"./constants.js";import{M as w,a as x}from"./MeshBasicMaterial.js";import{C as T}from"./Color.js";import"./Quaternion.js";import{V as S,O as R,M as A}from"./Object3D.js";import{d as _,V as L,c as E,F as O,S as I,B as P,f as j}from"./BufferGeometry.js";import{R as C,M as U}from"./Mesh.js";import{A as N,P as D,I as B,V as H,Q as k,N as F}from"./AnimationClip.js";import{C as G,P as z}from"./PerspectiveCamera.js";import{F as W,T as K,G as V}from"./Texture.js";import{L as X}from"./Light.js";function Y(s,i){this.array=s,this.stride=i,this.count=void 0!==s?s.length/i:0,this.usage=e,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=t.generateUUID()}Object.defineProperty(Y.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Y.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,s){t*=this.stride,s*=e.stride;for(let i=0,n=this.stride;i<n;i++)this.array[t+i]=e.array[s+i];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=t.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const s=new Y(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return s.setUsage(this.usage),s},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=t.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const q=new S;function $(t,e,s,i){this.name="",this.data=t,this.itemSize=e,this.offset=s,this.normalized=!0===i}function Z(t,e,s,i,n,r){G.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==s?s:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()}function J(t){w.call(this),this.type="LineBasicMaterial",this.color=new T(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}function Q(t){w.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new T(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new T(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=s,this.normalScale=new L(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function tt(t){Q.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new L(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(t)}function et(t){w.call(this),this.type="PointsMaterial",this.color=new T(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}function st(){R.call(this),this.type="Bone"}function it(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new L(512,512),this.map=null,this.mapPass=null,this.matrix=new A,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new W,this._frameExtents=new L(1,1),this._viewportCount=1,this._viewports=[new E(0,0,1,1)]}function nt(){it.call(this,new Z(-5,5,5,-5,.5,500))}function rt(t,e){X.call(this,t,e),this.type="DirectionalLight",this.position.copy(R.DefaultUp),this.updateMatrix(),this.target=new R,this.shadow=new nt}function ot(){it.call(this,new z(90,1,.5,500)),this._frameExtents=new L(4,2),this._viewportCount=6,this._viewports=[new E(2,1,1,1),new E(0,1,1,1),new E(3,1,1,1),new E(1,1,1,1),new E(3,0,1,1),new E(1,0,1,1)],this._cubeDirections=[new S(1,0,0),new S(-1,0,0),new S(0,0,1),new S(0,0,-1),new S(0,1,0),new S(0,-1,0)],this._cubeUps=[new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,0,1),new S(0,0,-1)]}function at(t,e,s,i){X.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==s?s:0,this.decay=void 0!==i?i:1,this.shadow=new ot}function ct(){it.call(this,new z(50,1,.5,500))}function ht(t,e,s,i,n,r){X.call(this,t,e),this.type="SpotLight",this.position.copy(R.DefaultUp),this.updateMatrix(),this.target=new R,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==s?s:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new ct}Object.defineProperties($.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(t){this.data.needsUpdate=t}}}),Object.assign($.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let e=0,s=this.data.count;e<s;e++)q.x=this.getX(e),q.y=this.getY(e),q.z=this.getZ(e),q.applyMatrix4(t),this.setXYZ(e,q.x,q.y,q.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,s){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=s,this},setXYZ:function(t,e,s,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=i,this},setXYZW:function(t,e,s,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=i,this.data.array[t+3]=n,this},clone:function(t){if(void 0===t){const t=[];for(let e=0;e<this.count;e++){const s=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[s+e])}return new _(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new $(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){const t=[];for(let e=0;e<this.count;e++){const s=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[s+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),Z.prototype=Object.assign(Object.create(G.prototype),{constructor:Z,isOrthographicCamera:!0,copy:function(t,e){return G.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,s,i,n,r){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=s,this.view.offsetY=i,this.view.width=n,this.view.height=r,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let n=s-t,r=s+t,o=i+e,a=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=t*this.view.offsetX,r=n+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(n,r,o,a,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){const e=R.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),J.prototype=Object.create(w.prototype),J.prototype.constructor=J,J.prototype.isLineBasicMaterial=!0,J.prototype.copy=function(t){return w.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this},Q.prototype=Object.create(w.prototype),Q.prototype.constructor=Q,Q.prototype.isMeshStandardMaterial=!0,Q.prototype.copy=function(t){return w.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},tt.prototype=Object.create(Q.prototype),tt.prototype.constructor=tt,tt.prototype.isMeshPhysicalMaterial=!0,tt.prototype.copy=function(t){return Q.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new T).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this},et.prototype=Object.create(w.prototype),et.prototype.constructor=et,et.prototype.isPointsMaterial=!0,et.prototype.copy=function(t){return w.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this},st.prototype=Object.assign(Object.create(R.prototype),{constructor:st,isBone:!0}),Object.assign(it.prototype,{_projScreenMatrix:new A,_lightPositionWorld:new S,_lookTarget:new S,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){const e=this.camera,s=this.matrix,i=this._projScreenMatrix,n=this._lookTarget,r=this._lightPositionWorld;r.setFromMatrixPosition(t.matrixWorld),e.position.copy(r),n.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(n),e.updateMatrixWorld(),i.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(e.projectionMatrix),s.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),nt.prototype=Object.assign(Object.create(it.prototype),{constructor:nt,isDirectionalLightShadow:!0,updateMatrices:function(t){it.prototype.updateMatrices.call(this,t)}}),rt.prototype=Object.assign(Object.create(X.prototype),{constructor:rt,isDirectionalLight:!0,copy:function(t){return X.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),ot.prototype=Object.assign(Object.create(it.prototype),{constructor:ot,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);const s=this.camera,i=this.matrix,n=this._lightPositionWorld,r=this._lookTarget,o=this._projScreenMatrix;n.setFromMatrixPosition(t.matrixWorld),s.position.copy(n),r.copy(s.position),r.add(this._cubeDirections[e]),s.up.copy(this._cubeUps[e]),s.lookAt(r),s.updateMatrixWorld(),i.makeTranslation(-n.x,-n.y,-n.z),o.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}}),at.prototype=Object.assign(Object.create(X.prototype),{constructor:at,isPointLight:!0,copy:function(t){return X.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),ct.prototype=Object.assign(Object.create(it.prototype),{constructor:ct,isSpotLightShadow:!0,updateMatrices:function(e){const s=this.camera,i=2*t.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height,r=e.distance||s.far;i===s.fov&&n===s.aspect&&r===s.far||(s.fov=i,s.aspect=n,s.far=r,s.updateProjectionMatrix()),it.prototype.updateMatrices.call(this,e)}}),ht.prototype=Object.assign(Object.create(X.prototype),{constructor:ht,isSpotLight:!0,copy:function(t){return X.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}});const lt={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};const ut=new function(t,e,s){const i=this;let n=!1,r=0,o=0,a=void 0;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=s,this.itemStart=function(t){o++,!1===n&&void 0!==i.onStart&&i.onStart(t,r,o),n=!0},this.itemEnd=function(t){r++,void 0!==i.onProgress&&i.onProgress(t,r,o),r===o&&(n=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return a?a(t):t},this.setURLModifier=function(t){return a=t,this},this.addHandler=function(t,e){return c.push(t,e),this},this.removeHandler=function(t){const e=c.indexOf(t);return-1!==e&&c.splice(e,2),this},this.getHandler=function(t){for(let e=0,s=c.length;e<s;e+=2){const s=c[e],i=c[e+1];if(s.global&&(s.lastIndex=0),s.test(t))return i}return null}};function pt(t){this.manager=void 0!==t?t:ut,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(pt.prototype,{load:function(){},loadAsync:function(t,e){const s=this;return new Promise((function(i,n){s.load(t,i,e,n)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});const dt={};function ft(t){pt.call(this,t)}function mt(t){pt.call(this,t),this.options={premultiplyAlpha:"none"}}ft.prototype=Object.assign(Object.create(pt.prototype),{constructor:ft,load:function(t,e,s,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,r=lt.get(t);if(void 0!==r)return n.manager.itemStart(t),setTimeout((function(){e&&e(r),n.manager.itemEnd(t)}),0),r;if(void 0!==dt[t])return void dt[t].push({onLoad:e,onProgress:s,onError:i});const o=t.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(o){const s=o[1],r=!!o[2];let a=o[3];a=decodeURIComponent(a),r&&(a=atob(a));try{let i;const r=(this.responseType||"").toLowerCase();switch(r){case"arraybuffer":case"blob":const t=new Uint8Array(a.length);for(let e=0;e<a.length;e++)t[e]=a.charCodeAt(e);i="blob"===r?new Blob([t.buffer],{type:s}):t.buffer;break;case"document":const e=new DOMParser;i=e.parseFromString(a,s);break;case"json":i=JSON.parse(a);break;default:i=a}setTimeout((function(){e&&e(i),n.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)}),0)}}else{dt[t]=[],dt[t].push({onLoad:e,onProgress:s,onError:i}),a=new XMLHttpRequest,a.open("GET",t,!0),a.addEventListener("load",(function(e){const s=this.response,i=dt[t];if(delete dt[t],200===this.status||0===this.status){this.status,lt.add(t,s);for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onLoad&&e.onLoad(s)}n.manager.itemEnd(t)}else{for(let t=0,s=i.length;t<s;t++){const s=i[t];s.onError&&s.onError(e)}n.manager.itemError(t),n.manager.itemEnd(t)}}),!1),a.addEventListener("progress",(function(e){const s=dt[t];for(let t=0,i=s.length;t<i;t++){const i=s[t];i.onProgress&&i.onProgress(e)}}),!1),a.addEventListener("error",(function(e){const s=dt[t];delete dt[t];for(let t=0,i=s.length;t<i;t++){const i=s[t];i.onError&&i.onError(e)}n.manager.itemError(t),n.manager.itemEnd(t)}),!1),a.addEventListener("abort",(function(e){const s=dt[t];delete dt[t];for(let t=0,i=s.length;t<i;t++){const i=s[t];i.onError&&i.onError(e)}n.manager.itemError(t),n.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)a.setRequestHeader(t,this.requestHeader[t]);a.send(null)}return n.manager.itemStart(t),a},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this}}),mt.prototype=Object.assign(Object.create(pt.prototype),{constructor:mt,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,e,s,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,r=lt.get(t);if(void 0!==r)return n.manager.itemStart(t),setTimeout((function(){e&&e(r),n.manager.itemEnd(t)}),0),r;fetch(t).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,n.options)})).then((function(s){lt.add(t,s),e&&e(s),n.manager.itemEnd(t)})).catch((function(e){i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)})),n.manager.itemStart(t)}});const gt=function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let s=0,i=t.length;s<i;s++)e+=String.fromCharCode(t[s]);try{return decodeURIComponent(escape(e))}catch(t){return e}},yt=function(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)};function vt(t){pt.call(this,t)}function bt(t){pt.call(this,t)}vt.prototype=Object.assign(Object.create(pt.prototype),{constructor:vt,load:function(t,e,s,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,r=lt.get(t);if(void 0!==r)return n.manager.itemStart(t),setTimeout((function(){e&&e(r),n.manager.itemEnd(t)}),0),r;const o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){o.removeEventListener("load",a,!1),o.removeEventListener("error",c,!1),lt.add(t,this),e&&e(this),n.manager.itemEnd(t)}function c(e){o.removeEventListener("load",a,!1),o.removeEventListener("error",c,!1),i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)}return o.addEventListener("load",a,!1),o.addEventListener("error",c,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),n.manager.itemStart(t),o.src=t,o}}),bt.prototype=Object.assign(Object.create(pt.prototype),{constructor:bt,load:function(t,e,s,r){const o=new K,a=new vt(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,(function(s){o.image=s;const r=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);o.format=r?i:n,o.needsUpdate=!0,void 0!==e&&e(o)}),s,r),o}});const Mt=new S,wt=new S,xt=new A,Tt=new C,St=new I;function Rt(t,e,s){R.call(this),this.type="Line",this.geometry=void 0!==t?t:new P,this.material=void 0!==e?e:new J,this.updateMorphTargets()}function At(t,e){Rt.call(this,t,e),this.type="LineLoop"}Rt.prototype=Object.assign(Object.create(R.prototype),{constructor:Rt,isLine:!0,copy:function(t){return R.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry){if(null===t.index){const e=t.attributes.position,s=[0];for(let t=1,i=e.count;t<i;t++)Mt.fromBufferAttribute(e,t-1),wt.fromBufferAttribute(e,t),s[t]=s[t-1],s[t]+=Mt.distanceTo(wt);t.setAttribute("lineDistance",new O(s,1))}}else if(t.isGeometry){const e=t.vertices,s=t.lineDistances;s[0]=0;for(let t=1,i=e.length;t<i;t++)s[t]=s[t-1],s[t]+=e[t-1].distanceTo(e[t])}return this},raycast:function(t,e){const s=this.geometry,i=this.matrixWorld,n=t.params.Line.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),St.copy(s.boundingSphere),St.applyMatrix4(i),St.radius+=n,!1===t.ray.intersectsSphere(St))return;xt.getInverse(i),Tt.copy(t.ray).applyMatrix4(xt);const r=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=r*r,a=new S,c=new S,h=new S,l=new S,u=this&&this.isLineSegments?2:1;if(s.isBufferGeometry){const i=s.index,n=s.attributes.position.array;if(null!==i){const s=i.array;for(let i=0,r=s.length-1;i<r;i+=u){const r=s[i],u=s[i+1];a.fromArray(n,3*r),c.fromArray(n,3*u);if(Tt.distanceSqToSegment(a,c,l,h)>o)continue;l.applyMatrix4(this.matrixWorld);const p=t.ray.origin.distanceTo(l);p<t.near||p>t.far||e.push({distance:p,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else for(let s=0,i=n.length/3-1;s<i;s+=u){a.fromArray(n,3*s),c.fromArray(n,3*s+3);if(Tt.distanceSqToSegment(a,c,l,h)>o)continue;l.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(l);i<t.near||i>t.far||e.push({distance:i,point:h.clone().applyMatrix4(this.matrixWorld),index:s,face:null,faceIndex:null,object:this})}}else if(s.isGeometry){const i=s.vertices,n=i.length;for(let s=0;s<n-1;s+=u){if(Tt.distanceSqToSegment(i[s],i[s+1],l,h)>o)continue;l.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(l);n<t.near||n>t.far||e.push({distance:n,point:h.clone().applyMatrix4(this.matrixWorld),index:s,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,s=Object.keys(e);if(s.length>0){const t=e[s[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,s=t.length;e<s;e++){const s=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length}}}),At.prototype=Object.assign(Object.create(Rt.prototype),{constructor:At,isLineLoop:!0});const _t=new S,Lt=new S;function Et(t,e){Rt.call(this,t,e),this.type="LineSegments"}Et.prototype=Object.assign(Object.create(Rt.prototype),{constructor:Et,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry){if(null===t.index){const e=t.attributes.position,s=[];for(let t=0,i=e.count;t<i;t+=2)_t.fromBufferAttribute(e,t),Lt.fromBufferAttribute(e,t+1),s[t]=0===t?0:s[t-1],s[t+1]=s[t]+_t.distanceTo(Lt);t.setAttribute("lineDistance",new O(s,1))}}else if(t.isGeometry){const e=t.vertices,s=t.lineDistances;for(let t=0,i=e.length;t<i;t+=2)_t.copy(e[t]),Lt.copy(e[t+1]),s[t]=0===t?0:s[t-1],s[t+1]=s[t]+_t.distanceTo(Lt)}return this}});const Ot=new A,It=new C,Pt=new I,jt=new S;function Ct(t,e){R.call(this),this.type="Points",this.geometry=void 0!==t?t:new P,this.material=void 0!==e?e:new et,this.updateMorphTargets()}function Ut(t,e,s,i,n,r,o){const a=It.distanceSqToPoint(t);if(a<s){const s=new S;It.closestPointToPoint(t,s),s.applyMatrix4(i);const c=n.ray.origin.distanceTo(s);if(c<n.near||c>n.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:s,index:e,face:null,object:o})}}Ct.prototype=Object.assign(Object.create(R.prototype),{constructor:Ct,isPoints:!0,copy:function(t){return R.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,e){const s=this.geometry,i=this.matrixWorld,n=t.params.Points.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),Pt.copy(s.boundingSphere),Pt.applyMatrix4(i),Pt.radius+=n,!1===t.ray.intersectsSphere(Pt))return;Ot.getInverse(i),It.copy(t.ray).applyMatrix4(Ot);const r=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=r*r;if(s.isBufferGeometry){const n=s.index,r=s.attributes.position.array;if(null!==n){const s=n.array;for(let n=0,a=s.length;n<a;n++){const a=s[n];jt.fromArray(r,3*a),Ut(jt,a,o,i,t,e,this)}}else for(let s=0,n=r.length/3;s<n;s++)jt.fromArray(r,3*s),Ut(jt,s,o,i,t,e,this)}else{const n=s.vertices;for(let s=0,r=n.length;s<r;s++)Ut(n[s],s,o,i,t,e,this)}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,s=Object.keys(e);if(s.length>0){const t=e[s[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,s=t.length;e<s;e++){const s=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length}}});const Nt=new A,Dt=new A;function Bt(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new A)}}function Ht(t,e){t&&t.isGeometry,U.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new A,this.bindMatrixInverse=new A}function kt(t,e,s,i,n,r,o,a,c){K.call(this,t,e,s,i,n,r,o,a,c),this.needsUpdate=!0}Object.assign(Bt.prototype,{calculateInverses:function(){this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++){const e=new A;this.bones[t]&&e.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(e)}},pose:function(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.getInverse(this.boneInverses[t])}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}},update:function(){const t=this.bones,e=this.boneInverses,s=this.boneMatrices,i=this.boneTexture;for(let i=0,n=t.length;i<n;i++){const n=t[i]?t[i].matrixWorld:Dt;Nt.multiplyMatrices(n,e[i]),Nt.toArray(s,16*i)}void 0!==i&&(i.needsUpdate=!0)},clone:function(){return new Bt(this.bones,this.boneInverses)},getBoneByName:function(t){for(let e=0,s=this.bones.length;e<s;e++){const s=this.bones[e];if(s.name===t)return s}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),Ht.prototype=Object.assign(Object.create(U.prototype),{constructor:Ht,isSkinnedMesh:!0,copy:function(t){return U.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new E,e=this.geometry.attributes.skinWeight;for(let s=0,i=e.count;s<i;s++){t.x=e.getX(s),t.y=e.getY(s),t.z=e.getZ(s),t.w=e.getW(s);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(s,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){U.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode&&this.bindMatrixInverse.getInverse(this.bindMatrix)},boneTransform:function(){const t=new S,e=new E,s=new E,i=new S,n=new A;return function(r,o){const a=this.skeleton,c=this.geometry;e.fromBufferAttribute(c.attributes.skinIndex,r),s.fromBufferAttribute(c.attributes.skinWeight,r),t.fromBufferAttribute(c.attributes.position,r).applyMatrix4(this.bindMatrix),o.set(0,0,0);for(let r=0;r<4;r++){const c=s.getComponent(r);if(0!==c){const s=e.getComponent(r);n.multiplyMatrices(a.bones[s].matrixWorld,a.boneInverses[s]),o.addScaledVector(i.copy(t).applyMatrix4(n),c)}}return o.applyMatrix4(this.bindMatrixInverse)}}()}),kt.prototype=Object.create(K.prototype),kt.prototype.constructor=kt,kt.prototype.isCanvasTexture=!0;const Ft=function(){function e(t){pt.call(this,t),this.dracoLoader=null,this.ddsLoader=null,this.pluginCallbacks=[],this.register((function(t){return new K(t)}))}function E(){let t={};return{get:e=>t[e],add(e,s){t[e]=s},remove(e){delete t[e]},removeAll(){t={}}}}e.prototype=Object.assign(Object.create(pt.prototype),{constructor:e,load:function(t,e,s,i){const n=this;let r;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:yt(t),n.manager.itemStart(t);const o=e=>{i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)},a=new ft(n.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),"use-credentials"===n.crossOrigin&&a.setWithCredentials(!0),a.load(t,(function(s){try{n.parse(s,r,(function(s){e(s),n.manager.itemEnd(t)}),o)}catch(t){o(t)}}),s,o)},setDRACOLoader(t){return this.dracoLoader=t,this},setDDSLoader(t){return this.ddsLoader=t,this},register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this},unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this},parse(t,e,s,i){let n;const r={},o={};if("string"==typeof t)n=t;else{if(gt(new Uint8Array(t,0,4))===X){try{r[O.KHR_BINARY_GLTF]=new nt(t)}catch(t){return void(i&&i(t))}n=r[O.KHR_BINARY_GLTF].content}else n=gt(new Uint8Array(t))}const a=JSON.parse(n);if(void 0===a.asset||a.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new $t(a,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});c.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](c);o[e.name]=e,r[e.name]=!0}if(a.extensionsUsed)for(let t=0;t<a.extensionsUsed.length;++t){const e=a.extensionsUsed[t],s=a.extensionsRequired||[];switch(e){case O.KHR_LIGHTS_PUNCTUAL:r[e]=new G(a);break;case O.KHR_MATERIALS_UNLIT:r[e]=new W;break;case O.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:r[e]=new ut;break;case O.KHR_DRACO_MESH_COMPRESSION:r[e]=new ot(a,this.dracoLoader);break;case O.MSFT_TEXTURE_DDS:r[e]=new C(this.ddsLoader);break;case O.KHR_TEXTURE_TRANSFORM:r[e]=new ct;break;case O.KHR_MESH_QUANTIZATION:r[e]=new dt;break;default:s.indexOf(e)>=0&&o[e]}}c.setExtensions(r),c.setPlugins(o),c.parse(s,i)}});const O={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function C(t){if(!t)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=O.MSFT_TEXTURE_DDS,this.ddsLoader=t}function G(t){this.name=O.KHR_LIGHTS_PUNCTUAL;const e=t.extensions&&t.extensions[O.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=e.lights||[]}function W(){this.name=O.KHR_MATERIALS_UNLIT}function K(t){this.parser=t,this.name=O.KHR_MATERIALS_CLEARCOAT}G.prototype.loadLight=function(t){const e=this.lightDefs[t];let s;const i=new T(16777215);void 0!==e.color&&i.fromArray(e.color);const n=void 0!==e.range?e.range:0;switch(e.type){case"directional":s=new rt(i),s.target.position.set(0,0,-1),s.add(s.target);break;case"point":s=new at(i),s.distance=n;break;case"spot":s=new ht(i),s.distance=n,e.spot=e.spot||{},e.spot.innerConeAngle=void 0!==e.spot.innerConeAngle?e.spot.innerConeAngle:0,e.spot.outerConeAngle=void 0!==e.spot.outerConeAngle?e.spot.outerConeAngle:Math.PI/4,s.angle=e.spot.outerConeAngle,s.penumbra=1-e.spot.innerConeAngle/e.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+e.type+'".')}return s.position.set(0,0,0),s.decay=2,void 0!==e.intensity&&(s.intensity=e.intensity),s.name=e.name||"light_"+t,Promise.resolve(s)},W.prototype.getMaterialType=function(){return x},W.prototype.extendParams=function(t,e,s){const i=[];t.color=new T(1,1,1),t.opacity=1;const n=e.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==n.baseColorTexture&&i.push(s.assignTexture(t,"map",n.baseColorTexture))}return Promise.all(i)},K.prototype.getMaterialType=function(){return tt},K.prototype.extendMaterialParams=function(t,e){const s=this.parser,i=s.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];if(void 0!==r.clearcoatFactor&&(e.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&n.push(s.assignTexture(e,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(e.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&n.push(s.assignTexture(e,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(n.push(s.assignTexture(e,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const t=r.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new L(t,t)}return Promise.all(n)};const X="glTF",q=1313821514,it=5130562;function nt(t){this.name=O.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12);if(this.header={magic:gt(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==X)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=new DataView(t,12);let i=0;for(;i<s.byteLength;){const e=s.getUint32(i,!0);i+=4;const n=s.getUint32(i,!0);if(i+=4,n===q){const s=new Uint8Array(t,12+i,e);this.content=gt(s)}else if(n===it){const s=12+i;this.body=t.slice(s,s+e)}i+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function ot(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=O.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}function ct(){this.name=O.KHR_TEXTURE_TRANSFORM}function lt(t){Q.call(this),this.isGLTFSpecularGlossinessMaterial=!0;const e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),n=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),r=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),o={specular:{value:(new T).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(t){for(let e in o)t.uniforms[e]=o[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),t.fragmentShader=t.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),t.fragmentShader=t.fragmentShader.replace("#include <roughnessmap_pars_fragment>",e),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_pars_fragment>",s),t.fragmentShader=t.fragmentShader.replace("#include <roughnessmap_fragment>",i),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_fragment>",n),t.fragmentShader=t.fragmentShader.replace("#include <lights_physical_fragment>",r)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(t){o.specular.value=t}},specularMap:{get:function(){return o.specularMap.value},set:function(t){o.specularMap.value=t}},glossiness:{get:function(){return o.glossiness.value},set:function(t){o.glossiness.value=t}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(t){o.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}function ut(){return{name:O.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return lt},extendParams:function(t,e,s){const i=e.extensions[this.name];t.color=new T(1,1,1),t.opacity=1;const n=[];if(Array.isArray(i.diffuseFactor)){const e=i.diffuseFactor;t.color.fromArray(e),t.opacity=e[3]}if(void 0!==i.diffuseTexture&&n.push(s.assignTexture(t,"map",i.diffuseTexture)),t.emissive=new T(0,0,0),t.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,t.specular=new T(1,1,1),Array.isArray(i.specularFactor)&&t.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){const e=i.specularGlossinessTexture;n.push(s.assignTexture(t,"glossinessMap",e)),n.push(s.assignTexture(t,"specularMap",e))}return Promise.all(n)},createMaterial:function(t){const e=new lt(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=s,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}}function dt(){this.name=O.KHR_MESH_QUANTIZATION}function vt(t,e,s,i){B.call(this,t,e,s,i)}ot.prototype.decodePrimitive=function(t,e){const s=this.json,i=this.dracoLoader,n=t.extensions[this.name].bufferView,r=t.extensions[this.name].attributes,o={},a={},c={};for(let t in r){const e=Ut[t]||t.toLowerCase();o[e]=r[t]}for(attributeName in t.attributes){const e=Ut[attributeName]||attributeName.toLowerCase();if(void 0!==r[attributeName]){const i=s.accessors[t.attributes[attributeName]],n=Ot[i.componentType];c[e]=n,a[e]=!0===i.normalized}}return e.getDependency("bufferView",n).then((function(t){return new Promise((function(e){i.decodeDracoFile(t,(function(t){for(let e in t.attributes){const s=t.attributes[e],i=a[e];void 0!==i&&(s.normalized=i)}e(t)}),o,c)}))}))},ct.prototype.extendTexture=function(t,e){return t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),e.texCoord,t.needsUpdate=!0,t},lt.prototype=Object.create(Q.prototype),lt.prototype.constructor=lt,lt.prototype.copy=function(t){return Q.prototype.copy.call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},vt.prototype=Object.create(B.prototype),vt.prototype.constructor=vt,vt.prototype.copySampleValue_=function(t){const e=this.resultBuffer,s=this.sampleValues,i=this.valueSize,n=t*i*3+i;for(let t=0;t!==i;t++)e[t]=s[n+t];return e},vt.prototype.beforeStart_=vt.prototype.copySampleValue_,vt.prototype.afterEnd_=vt.prototype.copySampleValue_,vt.prototype.interpolate_=function(t,e,s,i){const n=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=2*o,c=3*o,h=i-e,l=(s-e)/h,u=l*l,p=u*l,d=t*c,f=d-c,m=-2*p+3*u,g=p-u,y=1-m,v=g-u+l;for(let t=0;t!==o;t++){const e=r[f+t+o],s=r[f+t+a]*h,i=r[d+t+o],c=r[d+t]*h;n[t]=y*e+v*s+m*i+g*c}return n};const Mt=0,wt=1,xt=2,Tt=3,St=4,_t=5,Lt=6,Ot={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},It={9728:u,9729:r,9984:p,9985:d,9986:f,9987:o},Pt={33071:m,33648:g,10497:a},jt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ut={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Nt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Dt={CUBICSPLINE:void 0,LINEAR:l,STEP:y},Ft="OPAQUE",Gt="MASK",zt="BLEND",Wt={"image/png":n,"image/jpeg":i};function Kt(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}function Vt(t,e,s){for(let i in s.extensions)void 0===t[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=s.extensions[i])}function Xt(t,e){void 0!==e.extras&&"object"==typeof e.extras&&Object.assign(t.userData,e.extras)}function Yt(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let s=0,i=e.weights.length;s<i;s++)t.morphTargetInfluences[s]=e.weights[s];if(e.extras&&Array.isArray(e.extras.targetNames)){const s=e.extras.targetNames;if(t.morphTargetInfluences.length===s.length){t.morphTargetDictionary={};for(let e=0,i=s.length;e<i;e++)t.morphTargetDictionary[s[e]]=e}}}function qt(t){const e=t.extensions&&t.extensions[O.KHR_DRACO_MESH_COMPRESSION];if(e){const{bufferView:t,indices:s,attributes:i}=e;return`draco:${t}:${s}:${i}`}{const{indices:e,attributes:s,mode:i}=t;return`${e}:${function(t){let e="";const s=Object.keys(t).sort();for(let i=0,n=s.length;i<n;i++)e+=s[i]+":"+t[s[i]]+";";return e}(s)}:${i}`}}function $t(t,e){this.json=t||{},this.extensions={},this.plugins={},this.options=e||{},this.cache=new E,this.associations=new Map,this.primitiveCache={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new mt(this.options.manager):this.textureLoader=new bt(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new ft(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function Zt(t,e,s){const i=e.attributes,n=[],r=(e,i)=>s.getDependency("accessor",e).then((function(e){t.setAttribute(i,e)}));for(let e in i){const s=Ut[e]||e.toLowerCase();s in t.attributes||n.push(r(i[e],s))}if(void 0!==e.indices&&!t.index){const i=s.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));n.push(i)}return Xt(t,e),function(t,e,s){const i=e.attributes,n=new j;if(void 0===i.POSITION)return;{const t=s.json.accessors[i.POSITION],{max:e,min:r}=t;if(void 0===r||void 0===e)return;n.set(new S(r[0],r[1],r[2]),new S(e[0],e[1],e[2]))}const r=e.targets;if(void 0!==r){const t=new S,e=new S;for(let i=0,n=r.length;i<n;i++){const n=r[i];if(void 0!==n.POSITION){const i=s.json.accessors[n.POSITION],{max:r,min:o}=i;void 0!==o&&void 0!==r&&(e.setX(Math.max(Math.abs(o[0]),Math.abs(r[0]))),e.setY(Math.max(Math.abs(o[1]),Math.abs(r[1]))),e.setZ(Math.max(Math.abs(o[2]),Math.abs(r[2]))),t.max(e))}}n.expandByVector(t)}t.boundingBox=n;const o=new I;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,t.boundingSphere=o}(t,e,s),Promise.all(n).then(()=>void 0!==e.targets?function(t,e,s){let i=!1,n=!1;for(let t=0,s=e.length;t<s;t++){const s=e[t];if(void 0!==s.POSITION&&(i=!0),void 0!==s.NORMAL&&(n=!0),i&&n)break}if(!i&&!n)return Promise.resolve(t);const r=[],o=[];for(let a=0,c=e.length;a<c;a++){const c=e[a];if(i){const e=void 0!==c.POSITION?s.getDependency("accessor",c.POSITION):t.attributes.position;r.push(e)}if(n){const e=void 0!==c.NORMAL?s.getDependency("accessor",c.NORMAL):t.attributes.normal;o.push(e)}}return Promise.all([Promise.all(r),Promise.all(o)]).then((function(e){const s=e[0],r=e[1];return i&&(t.morphAttributes.position=s),n&&(t.morphAttributes.normal=r),t.morphTargetsRelative=!0,t}))}(t,e.targets,s):t)}function Jt(t,e){const s=t.getIndex();if(null===s){const e=[],i=t.getAttribute("position");if(void 0===i)return t;for(let t=0;t<i.count;t++)e.push(t);t.setIndex(e),s=t.getIndex()}const i=s.count-2,n=[];if(e===b)for(let t=1;t<=i;t++)n.push(s.getX(0)),n.push(s.getX(t)),n.push(s.getX(t+1));else for(let t=0;t<i;t++)t%2==0?(n.push(s.getX(t)),n.push(s.getX(t+1)),n.push(s.getX(t+2))):(n.push(s.getX(t+2)),n.push(s.getX(t+1)),n.push(s.getX(t)));const r=t.clone();return r.setIndex(n),r}return $t.prototype.setExtensions=function(t){this.extensions=t},$t.prototype.setPlugins=function(t){this.plugins=t},$t.prototype.parse=function(t,e){const s=this,{extensions:i,json:n}=this;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(e){const r={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:s,userData:{}};Vt(i,r,n),Xt(r,n),t(r)})).catch(e)},$t.prototype.markDefs=function(){const t=this.json.nodes||[],e=this.json.skins||[],s=this.json.meshes||[],i={},n={};for(let s=0,i=e.length;s<i;s++){const i=e[s].joints;for(let e=0,s=i.length;e<s;e++)t[i[e]].isBone=!0}for(let e=0,r=t.length;e<r;e++){const r=t[e];void 0!==r.mesh&&(void 0===i[r.mesh]&&(i[r.mesh]=n[r.mesh]=0),i[r.mesh]++,void 0!==r.skin&&(s[r.mesh].isSkinnedMesh=!0))}this.json.meshReferences=i,this.json.meshUses=n},$t.prototype._invokeOne=function(t){const e=Object.values(this.plugins);e.push(this);for(let s=0;s<e.length;s++){const i=t(e[s]);if(i)return i}},$t.prototype._invokeAll=function(t){const e=Object.values(this.plugins);e.unshift(this);const s=[];for(let i=0;i<e.length;i++)s.push(t(e[i]));return Promise.all(s)},$t.prototype.getDependency=function(t,e){const s=t+":"+e;let i=this.cache.get(s);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":i=this.loadTexture(e);break;case"skin":i=this.loadSkin(e);break;case"animation":i=this.loadAnimation(e);break;case"camera":i=this.loadCamera(e);break;case"light":i=this.extensions[O.KHR_LIGHTS_PUNCTUAL].loadLight(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(s,i)}return i},$t.prototype.getDependencies=function(t){let e=this.cache.get(t);if(!e){const s=this,i=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(i.map((e,i)=>s.getDependency(t,i))),this.cache.add(t,e)}return e},$t.prototype.loadBuffer=function(t){const e=this.json.buffers[t],s=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[O.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(t,n){s.load(Kt(e.uri,i.path),t,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))},$t.prototype.loadBufferView=function(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const{byteLength:s=0,byteOffset:i=0}=e;return t.slice(i,i+s)}))},$t.prototype.loadAccessor=function(t){const e=this,s=this.json,i=this.json.accessors[t];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);const n=[];return void 0!==i.bufferView?n.push(this.getDependency("bufferView",i.bufferView)):n.push(null),void 0!==i.sparse&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then((function(t){const n=t[0],r=jt[i.type],o=Ot[i.componentType],a=o.BYTES_PER_ELEMENT,c=a*r,h=i.byteOffset||0,l=void 0!==i.bufferView?s.bufferViews[i.bufferView].byteStride:void 0,u=!0===i.normalized;let p,d;if(l&&l!==c){const t=Math.floor(h/l),{bufferView:s,componentType:n,count:c}=i,f=`InterleavedBuffer:${s}:${n}:${t}:${c}`,m=e.cache.get(f);m||(p=new o(s,t*l,i.count*l/a),m=new Y(p,l/a),e.cache.add(f,m)),d=new $(m,r,h%l/a,u)}else p=null===n?new o(i.count*r):new o(n,h,i.count*r),d=new _(p,r,u);if(void 0!==i.sparse){const e=jt.SCALAR,s=Ot[i.sparse.indices.componentType],a=i.sparse.indices.byteOffset||0,c=i.sparse.values.byteOffset||0,h=new s(t[1],a,i.sparse.count*e),l=new o(t[2],c,i.sparse.count*r);null!==n&&(d=new _(d.array.slice(),d.itemSize,d.normalized));for(let t=0,e=h.length;t<e;t++){const e=h[t];if(d.setX(e,l[t*r]),r>=2&&d.setY(e,l[t*r+1]),r>=3&&d.setZ(e,l[t*r+2]),r>=4&&d.setW(e,l[t*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return d}))},$t.prototype.loadTexture=function(t){const e=this,{json:s,options:i,textureLoader:n}=this,c=self.URL||self.webkitURL,h=s.textures[t],l=h.extensions||{};let u;u=l[O.MSFT_TEXTURE_DDS]?s.images[l[O.MSFT_TEXTURE_DDS].source]:s.images[h.source];let p=u.uri,d=!1;return void 0!==u.bufferView&&(p=e.getDependency("bufferView",u.bufferView).then((function(t){d=!0;const e=new Blob([t],{type:u.mimeType});return p=c.createObjectURL(e),p}))),Promise.resolve(p).then((function(t){let s=i.manager.getHandler(t);return s||(s=l[O.MSFT_TEXTURE_DDS]?e.extensions[O.MSFT_TEXTURE_DDS].ddsLoader:n),new Promise((function(e,n){let r=e;!0===s.isImageBitmapLoader&&(r=t=>e(new kt(t))),s.load(Kt(t,i.path),r,void 0,n)}))})).then((function(i){!0===d&&c.revokeObjectURL(p),i.flipY=!1,h.name&&(i.name=h.name),u.mimeType in Wt&&(i.format=Wt[u.mimeType]);const n=(s.samplers||{})[h.sampler]||{};return i.magFilter=It[n.magFilter]||r,i.minFilter=It[n.minFilter]||o,i.wrapS=Pt[n.wrapS]||a,i.wrapT=Pt[n.wrapT]||a,e.associations.set(i,{type:"textures",index:t}),i}))},$t.prototype.assignTexture=function(t,e,s){const n=this;return this.getDependency("texture",s.index).then((function(r){if(!r.isCompressedTexture)switch(e){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":r.format=i}if(void 0!==s.texCoord&&0!=s.texCoord&&("aoMap"!==e||s.texCoord),n.extensions[O.KHR_TEXTURE_TRANSFORM]){const t=void 0!==s.extensions?s.extensions[O.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=n.associations.get(r);r=n.extensions[O.KHR_TEXTURE_TRANSFORM].extendTexture(r,t),n.associations.set(r,e)}}t[e]=r}))},$t.prototype.assignFinalMaterial=function(t){const e=t.geometry;let s=t.material;const i=void 0!==e.attributes.tangent,n=void 0!==e.attributes.color,r=void 0===e.attributes.normal,o=!0===t.isSkinnedMesh,a=Object.keys(e.morphAttributes).length>0,c=a&&void 0!==e.morphAttributes.normal;if(t.isPoints){let t="PointsMaterial:"+s.uuid;const e=this.cache.get(t);e||(e=new et,w.prototype.copy.call(e,s),e.color.copy(s.color),e.map=s.map,e.sizeAttenuation=!1,this.cache.add(t,e)),s=e}else if(t.isLine){const t="LineBasicMaterial:"+s.uuid,e=this.cache.get(t);e||(e=new J,w.prototype.copy.call(e,s),e.color.copy(s.color),this.cache.add(t,e)),s=e}if(i||n||r||o||a){let t="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(t+="specular-glossiness:"),o&&(t+="skinning:"),i&&(t+="vertex-tangents:"),n&&(t+="vertex-colors:"),r&&(t+="flat-shading:"),a&&(t+="morph-targets:"),c&&(t+="morph-normals:");let e=this.cache.get(t);e||(e=s.clone(),o&&(e.skinning=!0),i&&(e.vertexTangents=!0),n&&(e.vertexColors=!0),r&&(e.flatShading=!0),a&&(e.morphTargets=!0),c&&(e.morphNormals=!0),this.cache.add(t,e),this.associations.set(e,this.associations.get(s))),s=e}s.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),s.normalScale&&!i&&(s.normalScale.y=-s.normalScale.y),s.clearcoatNormalScale&&!i&&(s.clearcoatNormalScale.y=-s.clearcoatNormalScale.y),t.material=s},$t.prototype.getMaterialType=function(){return Q},$t.prototype.loadMaterial=function(t){const e=this,{extensions:s,json:i}=this,n=i.materials[t];let r;const o={},a=n.extensions||{},l=[];if(a[O.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const t=s[O.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=t.getMaterialType(),l.push(t.extendParams(o,n,e))}else if(a[O.KHR_MATERIALS_UNLIT]){const t=s[O.KHR_MATERIALS_UNLIT];r=t.getMaterialType(),l.push(t.extendParams(o,n,e))}else{const s=n.pbrMetallicRoughness||{};if(o.color=new T(1,1,1),o.opacity=1,Array.isArray(s.baseColorFactor)){const t=s.baseColorFactor;o.color.fromArray(t),o.opacity=t[3]}void 0!==s.baseColorTexture&&l.push(e.assignTexture(o,"map",s.baseColorTexture)),o.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,o.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(l.push(e.assignTexture(o,"metalnessMap",s.metallicRoughnessTexture)),l.push(e.assignTexture(o,"roughnessMap",s.metallicRoughnessTexture))),r=this._invokeOne(e=>e.getMaterialType&&e.getMaterialType(t)),l.push(this._invokeAll(e=>e.extendMaterialParams&&e.extendMaterialParams(t,o)))}!0===n.doubleSided&&(o.side=c);const u=n.alphaMode||Ft;return u===zt?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,u===Gt&&(o.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&r!==x&&(l.push(e.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new L(1,1),void 0!==n.normalTexture.scale&&o.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)),void 0!==n.occlusionTexture&&r!==x&&(l.push(e.assignTexture(o,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(o.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&r!==x&&(o.emissive=(new T).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&r!==x&&l.push(e.assignTexture(o,"emissiveMap",n.emissiveTexture)),Promise.all(l).then((function(){let i;return i=r===lt?s[O.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new r(o),n.name&&(i.name=n.name),i.map&&(i.map.encoding=h),i.emissiveMap&&(i.emissiveMap.encoding=h),Xt(i,n),e.associations.set(i,{type:"materials",index:t}),n.extensions&&Vt(s,i,n),i}))},$t.prototype.loadGeometries=function(t){const e=this,s=this.extensions,i=this.primitiveCache,n=t=>s[O.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then(s=>Zt(s,t,e)),r=[];for(let s=0,o=t.length;s<o;s++){const o=t[s],a=qt(o),c=i[a];if(c)r.push(c.promise);else{let t;t=o.extensions&&o.extensions[O.KHR_DRACO_MESH_COMPRESSION]?n(o):Zt(new P,o,e),i[a]={primitive:o,promise:t},r.push(t)}}return Promise.all(r)},$t.prototype.loadMesh=function(t){const e=this,{json:s}=this,i=s.meshes[t],n=i.primitives,r=[];for(let t=0,e=n.length;t<e;t++){const e=void 0===n[t].material?(void 0===(o=this.cache).DefaultMaterial&&(o.DefaultMaterial=new Q({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:v})),o.DefaultMaterial):this.getDependency("material",n[t].material);r.push(e)}var o;return r.push(e.loadGeometries(n)),Promise.all(r).then((function(s){const r=s.slice(0,s.length-1),o=s[s.length-1],a=[];for(let s=0,c=o.length;s<c;s++){const c=o[s],h=n[s];let l;const u=r[s];if(h.mode===St||h.mode===_t||h.mode===Lt||void 0===h.mode)l=!0===i.isSkinnedMesh?new Ht(c,u):new U(c,u),!0!==l.isSkinnedMesh||l.geometry.attributes.skinWeight.normalized||l.normalizeSkinWeights(),h.mode===_t?l.geometry=Jt(l.geometry,M):h.mode===Lt&&(l.geometry=Jt(l.geometry,b));else if(h.mode===wt)l=new Et(c,u);else if(h.mode===Tt)l=new Rt(c,u);else if(h.mode===xt)l=new At(c,u);else{if(h.mode!==Mt)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);l=new Ct(c,u)}Object.keys(l.geometry.morphAttributes).length>0&&Yt(l,i),l.name=i.name||"mesh_"+t,o.length>1&&(l.name+="_"+s),Xt(l,i),e.assignFinalMaterial(l),a.push(l)}if(1===a.length)return a[0];const c=new V;for(let t=0,e=a.length;t<e;t++)c.add(a[t]);return c}))},$t.prototype.loadCamera=function(e){let s;const i=this.json.cameras[e],n=i[i.type];if(n)return"perspective"===i.type?s=new z(t.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===i.type&&(s=new Z(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(s.name=i.name),Xt(s,i),Promise.resolve(s)},$t.prototype.loadSkin=function(t){const e=this.json.skins[t],s={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(s):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return s.inverseBindMatrices=t,s}))},$t.prototype.loadAnimation=function(t){const e=this.json.animations[t],s=[],i=[],n=[],r=[],o=[];for(let t=0,a=e.channels.length;t<a;t++){const a=e.channels[t],c=e.samplers[a.sampler],h=a.target,l=void 0!==h.node?h.node:h.id,u=void 0!==e.parameters?e.parameters[c.input]:c.input,p=void 0!==e.parameters?e.parameters[c.output]:c.output;s.push(this.getDependency("node",l)),i.push(this.getDependency("accessor",u)),n.push(this.getDependency("accessor",p)),r.push(c),o.push(h)}return Promise.all([Promise.all(s),Promise.all(i),Promise.all(n),Promise.all(r),Promise.all(o)]).then((function(s){const i=s[0],n=s[1],r=s[2],o=s[3],a=s[4],c=[];for(let t=0,e=i.length;t<e;t++){const e=i[t],s=n[t],h=r[t],u=o[t],p=a[t];if(void 0===e)continue;let d;switch(e.updateMatrix(),e.matrixAutoUpdate=!0,Nt[p.path]){case Nt.weights:d=F;break;case Nt.rotation:d=k;break;case Nt.position:case Nt.scale:default:d=H}const f=e.name?e.name:e.uuid,m=void 0!==u.interpolation?Dt[u.interpolation]:l,g=[];Nt[p.path]===Nt.weights?e.traverse((function(t){!0===t.isMesh&&t.morphTargetInfluences&&g.push(t.name?t.name:t.uuid)})):g.push(f);const y=h.array;if(h.normalized){let t;if(y.constructor===Int8Array)t=1/127;else if(y.constructor===Uint8Array)t=1/255;else if(y.constructor==Int16Array)t=1/32767;else{if(y.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");t=1/65535}const e=new Float32Array(y.length);for(let s=0,i=y.length;s<i;s++)e[s]=y[s]*t;y=e}for(let t=0,e=g.length;t<e;t++){const e=new d(g[t]+"."+Nt[p.path],s.array,y,m);"CUBICSPLINE"===u.interpolation&&(e.createInterpolant=function(t){return new vt(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(e)}}const h=e.name?e.name:"animation_"+t;return new N(h,void 0,c)}))},$t.prototype.loadNode=function(t){const{extensions:e,json:s}=this,i=this,n=s.meshReferences,r=s.meshUses,o=s.nodes[t];return function(){const t=[];return void 0!==o.mesh&&t.push(i.getDependency("mesh",o.mesh).then((function(t){let e;if(n[o.mesh]>1){const s=r[o.mesh]++;e=t.clone(),e.name+="_instance_"+s}else e=t;return void 0!==o.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,s=o.weights.length;e<s;e++)t.morphTargetInfluences[e]=o.weights[e]})),e}))),void 0!==o.camera&&t.push(i.getDependency("camera",o.camera)),o.extensions&&o.extensions[O.KHR_LIGHTS_PUNCTUAL]&&void 0!==o.extensions[O.KHR_LIGHTS_PUNCTUAL].light&&t.push(i.getDependency("light",o.extensions[O.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(t)}().then((function(s){let n;if(n=!0===o.isBone?new st:s.length>1?new V:1===s.length?s[0]:new R,n!==s[0])for(let t=0,e=s.length;t<e;t++)n.add(s[t]);if(o.name&&(n.userData.name=o.name,n.name=D.sanitizeNodeName(o.name)),Xt(n,o),o.extensions&&Vt(e,n,o),void 0!==o.matrix){const t=new A;t.fromArray(o.matrix),n.applyMatrix4(t)}else void 0!==o.translation&&n.position.fromArray(o.translation),void 0!==o.rotation&&n.quaternion.fromArray(o.rotation),void 0!==o.scale&&n.scale.fromArray(o.scale);return i.associations.set(n,{type:"nodes",index:t}),n}))},$t.prototype.loadScene=function(){function t(e,s,i,n){const r=i.nodes[e];return n.getDependency("node",e).then((function(t){if(void 0===r.skin)return t;let e;return n.getDependency("skin",r.skin).then((function(t){e=t;const s=[];for(let t=0,i=e.joints.length;t<i;t++)s.push(n.getDependency("node",e.joints[t]));return Promise.all(s)})).then((function(s){return t.traverse((function(t){if(!t.isMesh)return;const i=[],n=[];for(let t=0,r=s.length;t<r;t++){const r=s[t];if(r){i.push(r);const s=new A;void 0!==e.inverseBindMatrices&&s.fromArray(e.inverseBindMatrices.array,16*t),n.push(s)}}t.bind(new Bt(i,n),t.matrixWorld)})),t}))})).then((function(e){s.add(e);const o=[];if(r.children){const s=r.children;for(let r=0,a=s.length;r<a;r++){const a=s[r];o.push(t(a,e,i,n))}}return Promise.all(o)}))}return function(e){const{extensions:s,json:i}=this,n=i.scenes[e],r=this,o=new V;n.name&&(o.name=n.name),Xt(o,n),n.extensions&&Vt(s,o,n);const a=n.nodes||[],c=[];for(let e=0,s=a.length;e<s;e++)c.push(t(a[e],o,i,r));return Promise.all(c).then((function(){return o}))}}(),e}();export{Ft as GLTFLoader};
//# sourceMappingURL=GLTFLoader.js.map
