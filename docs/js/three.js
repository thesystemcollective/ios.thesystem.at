import{p as e,g as t}from"./main.js";import{AnimationMixer as n}from"./three.module.js";export{loadReticle}from"./loadReticle.js";import{G as r}from"./GLTFLoader.js";export{G as GLTFLoader,s as spawnModel}from"./GLTFLoader.js";const o=({camera:e,renderer:t})=>()=>{e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),t.setSize(window.innerWidth,window.innerHeight)};let i=null,a=!1;const d=e=>async(t,n)=>{const{camera:r,clock:o,mixer:s,renderer:d,reticle:c,scene:l,stats:m}=e;if(n){const e=d.xr.getSession();if(!1===a){const t=await e.requestReferenceSpace("viewer"),n=await e.requestHitTestSource({space:t});i=n,e.addEventListener("end",()=>{a=!1,i=null}),a=!0}if(i){const e=d.xr.getReferenceSpace(),t=n.getHitTestResults(i);if(t.length){if(c){const n=t[0];c.visible=!0,c.matrix.fromArray(n.getPose(e).transform.matrix)}}else c&&(c.visible=!1)}}s&&s.update(o.getDelta()),d.render(l,r)},c=async(o,i)=>{if(!o)throw new Error("loadModel needs { file } argument to be set.");i.show(e);const a=await((e,n,r)=>new Promise((o,i)=>{const a=`${t}/${n}`,s=(e=>t=>{if(t.total>0){const n=Math.ceil(t.loaded/t.total*100);e.setContent(`${n}% ${t.loaded}/${t.total}`)}t.loaded>=t.total&&e.hide()})(r);e.load(a,o,s,i)}))(new r,o,i),s=a.scene;let d=null;return a.animations&&a.animations.length&&(d=new n(s),a.animations.forEach(e=>d.clipAction(e).play())),{model:s,mixer:d}},l=async({camera:e,hemisphereLight:t,scene:n})=>{const{CameraHelper:r}=await import("./CameraHelper.js"),{default:o}=await import("./stats.module.js"),i=new r(e);if(n.add(i),t){const{HemisphereLightHelper:e}=await import("./HemisphereLightHelper.js"),r=new e(t);n.add(r)}const a=new o;return document.body.appendChild(a.dom),a},m=({gui:e,renderer:t,scene:n})=>{document.getElementById("exit-button").addEventListener("click",()=>{(async({renderer:e,scene:t})=>{if("xr"in e){const t=e.xr.getSession();t&&t.end()}var n;(n=t).remove.apply(n,n.children);const r=document.getElementById("three-canvas");if(r){const e=r.parentNode;"three-container"===e.id?e.removeChild(r):e.parentNode.removeChild(e)}})({renderer:t,scene:n}),e.style.display="none"})},p=({renderer:e,scene:t})=>{const n=document.getElementById("three-gui");n.style.display="block",m({renderer:e,scene:t,gui:n})};export{l as debugView,c as loadModel,o as onWindowResize,d as render,p as showHUD};
