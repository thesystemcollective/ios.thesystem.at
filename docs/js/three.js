import{p as e,g as t,s as r}from"./main.js";import{AnimationMixer as n}from"./three.module.js";import{G as i}from"./GLTFLoader.js";export{G as GLTFLoader,a as addSkybox,s as spawnModel}from"./GLTFLoader.js";export{loadReticle}from"./loadReticle.js";const o=({camera:e,renderer:t})=>()=>{e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),t.setSize(window.innerWidth,window.innerHeight)};let d=null,l=!1;const c=e=>async(t,r)=>{const{camera:a,clock:n,mixer:i,reflect:s,renderer:o,reticle:c,scene:m,stats:p,xrSupported:u}=e;if(r){const e=o.xr.getSession();if(!1===l){const t=await e.requestReferenceSpace("viewer"),r=await e.requestHitTestSource({space:t});d=r,e.addEventListener("end",()=>{l=!1,d=null}),l=!0}if(d){const e=o.xr.getReferenceSpace(),t=r.getHitTestResults(d);if(t.length){if(c){const r=t[0];c.visible=!0,c.matrix.fromArray(r.getPose(e).transform.matrix)}}else c&&(c.visible=!1)}}s.target&&s.camera&&s.skybox&&(u&&(s.skybox.visible=!0),s.target.visible=!1,s.camera.updateCubeMap(o,m),u&&(s.skybox.visible=!1),s.target.visible=!0),i&&i.update(n.getDelta()),o.render(m,a)},m=async(r,a)=>{if(!r)throw new Error("loadModel needs { file } argument to be set.");a.show(e);const s=await((e,r,a)=>new Promise((n,i)=>{const s=`${t}/${r}`,o=(e=>t=>{if(t.total>0){const r=Math.ceil(t.loaded/t.total*100);e.setContent(`${r}% ${t.loaded}/${t.total}`)}t.loaded>=t.total&&e.hide()})(a);e.load(s,n,o,i)}))(new i,r,a),o=s.scene;let d=null;return s.animations&&s.animations.length&&(d=new n(o),s.animations.forEach(e=>d.clipAction(e).play())),{model:o,mixer:d}},p=async({camera:e,hemisphereLight:t,scene:r})=>{const{CameraHelper:a}=await import("./CameraHelper.js"),{default:n}=await import("./stats.module.js"),i=new a(e);if(r.add(i),t){const{HemisphereLightHelper:e}=await import("./HemisphereLightHelper.js"),a=new e(t);r.add(a)}const s=new n;return document.body.appendChild(s.dom),s},u=({renderer:e,scene:t})=>{const a=document.getElementById("three-gui");a.style.display="block",(({gui:e,renderer:t,scene:a})=>{document.getElementById("exit-button").addEventListener("click",()=>{r.end({renderer:t,scene:a}),e.style.display="none"})})({renderer:e,scene:t,gui:a})};export{p as debugView,m as loadModel,o as onWindowResize,c as render,u as showHUD};
