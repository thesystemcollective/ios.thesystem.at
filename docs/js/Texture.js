import{E as t,M as e}from"./MathUtils.js";import{bo as i,ak as s,g as n,aj as r,L as o,b as a,R as p,av as h,x as c}from"./constants.js";import{O as m,V as l,a as u}from"./Object3D.js";import{S as f,V as y}from"./BufferGeometry.js";import{P as d}from"./Mesh.js";function g(){m.call(this),this.type="Group"}g.prototype=Object.assign(Object.create(m.prototype),{constructor:g,isGroup:!0});const x=new f,w=new l;class v{constructor(t,e,i,s,n,r){this.planes=[void 0!==t?t:new d,void 0!==e?e:new d,void 0!==i?i:new d,void 0!==s?s:new d,void 0!==n?n:new d,void 0!==r?r:new d]}set(t,e,i,s,n,r){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(s),o[4].copy(n),o[5].copy(r),this}clone(){return(new this.constructor).copy(this)}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,s=i[0],n=i[1],r=i[2],o=i[3],a=i[4],p=i[5],h=i[6],c=i[7],m=i[8],l=i[9],u=i[10],f=i[11],y=i[12],d=i[13],g=i[14],x=i[15];return e[0].setComponents(o-s,c-a,f-m,x-y).normalize(),e[1].setComponents(o+s,c+a,f+m,x+y).normalize(),e[2].setComponents(o+n,c+p,f+l,x+d).normalize(),e[3].setComponents(o-n,c-p,f-l,x-d).normalize(),e[4].setComponents(o-r,c-h,f-u,x-g).normalize(),e[5].setComponents(o+r,c+h,f+u,x+g).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),x.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(x)}intersectsSprite(t){return x.center.set(0,0,0),x.radius=.7071067811865476,x.applyMatrix4(t.matrixWorld),this.intersectsSphere(x)}intersectsSphere(t){const e=this.planes,i=t.center,s=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(i)<s)return!1}return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const s=e[i];if(w.x=s.normal.x>0?t.max.x:t.min.x,w.y=s.normal.y>0?t.max.y:t.min.y,w.z=s.normal.z>0?t.max.z:t.min.z,s.distanceToPoint(w)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}}let M;const A=function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===M&&(M=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),M.width=t.width,M.height=t.height;const i=M.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=M}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")};let F=0;function T(t,i,s,r,m,l,f,d,g,x){Object.defineProperty(this,"id",{value:F++}),this.uuid=e.generateUUID(),this.name="",this.image=void 0!==t?t:T.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==i?i:T.DEFAULT_MAPPING,this.wrapS=void 0!==s?s:n,this.wrapT=void 0!==r?r:n,this.magFilter=void 0!==m?m:o,this.minFilter=void 0!==l?l:a,this.anisotropy=void 0!==g?g:1,this.format=void 0!==f?f:p,this.internalFormat=null,this.type=void 0!==d?d:h,this.offset=new y(0,0),this.repeat=new y(1,1),this.center=new y(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new u,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==x?x:c,this.version=0,this.onUpdate=null}T.DEFAULT_IMAGE=void 0,T.DEFAULT_MAPPING=i,T.prototype=Object.assign(Object.create(t.prototype),{constructor:T,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){const i=void 0===t||"string"==typeof t;if(!i&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=e.generateUUID()),!i&&void 0===t.images[n.uuid]){let e;if(Array.isArray(n)){e=[];for(let t=0,i=n.length;t<i;t++)e.push(A(n[t]))}else e=A(n);t.images[n.uuid]={uuid:n.uuid,url:e}}s.image=n.uuid}return i||(t.textures[this.uuid]=s),s},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping!==i)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case r:t.x=t.x-Math.floor(t.x);break;case n:t.x=t.x<0?0:1;break;case s:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case r:t.y=t.y-Math.floor(t.y);break;case n:t.y=t.y<0?0:1;break;case s:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(T.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});export{v as F,g as G,T};
